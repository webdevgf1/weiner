<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weiner Perkins - Innovative Memecoin Ventures</title>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'MS Sans Serif', 'Lucida Grande', sans-serif;
        }

        body {
            background-color: #008080; /* Classic Windows 98 teal */
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        /* Taskbar Styles */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 28px;
            background-color: #c0c0c0;
            border-top: 1px solid #ffffff;
            display: flex;
            z-index: 1000;
        }

        .start-button {
            display: flex;
            align-items: center;
            padding: 2px 5px;
            margin: 2px;
            background-color: #c0c0c0;
            border-top: 1px solid #ffffff;
            border-left: 1px solid #ffffff;
            border-right: 1px solid #808080;
            border-bottom: 1px solid #808080;
            cursor: pointer;
        }

        .start-button:active {
            border-top: 1px solid #808080;
            border-left: 1px solid #808080;
            border-right: 1px solid #ffffff;
            border-bottom: 1px solid #ffffff;
        }

        .start-button img {
            width: 16px;
            height: 16px;
            margin-right: 5px;
        }

        .taskbar-time {
            position: absolute;
            right: 5px;
            top: 7px;
            font-size: 11px;
            background-color: #c0c0c0;
            border-top: 1px solid #808080;
            border-left: 1px solid #808080;
            border-right: 1px solid #ffffff;
            border-bottom: 1px solid #ffffff;
            padding: 1px 5px;
        }

        /* Desktop Icon Styles */
        .desktop {
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, 80px);
            grid-auto-rows: 80px;
            grid-gap: 10px;
            height: calc(100vh - 28px);
        }

        .icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            font-size: 11px;
            cursor: pointer;
            padding: 5px;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.7);
        }

        .icon:hover {
            background-color: rgba(49, 106, 197, 0.3);
        }

        .icon:active, .icon.selected {
            background-color: rgba(49, 106, 197, 0.5);
        }

        .icon img {
            width: 32px;
            height: 32px;
            margin-bottom: 5px;
        }

        .icon-text {
            max-width: 70px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        /* Windows Styles */
        .window {
            position: absolute;
            background-color: #c0c0c0;
            border-top: 1px solid #dfdfdf;
            border-left: 1px solid #dfdfdf;
            border-right: 2px solid #404040;
            border-bottom: 2px solid #404040;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            min-width: 250px;
            min-height: 150px;
            display: none;
            z-index: 10;
        }
        
        /* AI Assistant Styles */
        .ai-message {
            margin-bottom: 10px;
        }
        
        .user-message {
            margin-bottom: 10px;
            text-align: right;
        }
        
        .user-message > div:first-child {
            font-weight: bold;
            color: #008000;
        }
        
        .user-message > div:last-child {
            background-color: #e8f4e8;
            padding: 5px;
            border: 1px solid #c0d0c0;
            border-radius: 3px;
            display: inline-block;
            text-align: left;
            max-width: 80%;
        }
        
        .typing-indicator {
            display: inline-block;
            padding: 5px 10px;
            background-color: #f0f0f0;
            border: 1px solid #d0d0d0;
            border-radius: 3px;
        }
        
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #666;
            border-radius: 50%;
            margin-right: 3px;
            animation: typing 1s infinite ease-in-out;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
            margin-right: 0;
        }
        
        @keyframes typing {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        .window.active {
            z-index: 100;
            display: block;
        }

        .window-header {
            background-color: #000080;
            color: white;
            padding: 3px 5px;
            font-weight: bold;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .window-buttons {
            display: flex;
        }

        .window-button {
            width: 16px;
            height: 14px;
            background-color: #c0c0c0;
            border-top: 1px solid #ffffff;
            border-left: 1px solid #ffffff;
            border-right: 1px solid #808080;
            border-bottom: 1px solid #808080;
            margin-left: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 9px;
            cursor: pointer;
        }

        .window-content {
            padding: 10px;
            height: calc(100% - 25px);
            overflow: auto;
            font-size: 12px;
            line-height: 1.4;
        }

        /* Start Menu Styles */
        .start-menu {
            position: fixed;
            bottom: 28px;
            left: 0;
            width: 200px;
            background-color: #c0c0c0;
            border-top: 2px solid #ffffff;
            border-left: 2px solid #ffffff;
            border-right: 2px solid #404040;
            border-bottom: 2px solid #404040;
            display: none;
            z-index: 2000;
        }

        .start-menu.active {
            display: block;
        }

        .start-menu-header {
            height: 35px;
            background-color: #000080;
            color: white;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-weight: bold;
            font-size: 14px;
        }

        .start-menu-items {
            padding: 2px 0;
        }

        .start-menu-item {
            padding: 5px 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .start-menu-item:hover {
            background-color: #000080;
            color: white;
        }

        .start-menu-item img {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }

        /* Custom Window Styles */
        .about-content, .token-content, .team-content, .roadmap-content {
            font-family: 'MS Sans Serif', 'Lucida Grande', sans-serif;
            font-size: 12px;
        }

        .about-content h3, .token-content h3, .team-content h3, .roadmap-content h3 {
            margin-bottom: 10px;
            color: #000080;
        }

        .about-content p, .token-content p, .team-content p, .roadmap-content p {
            margin-bottom: 10px;
        }

        .about-content ul, .token-content ul, .team-content ul, .roadmap-content ul {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        /* Logo style for the 'My Computer' window */
        .logo-container {
            text-align: center;
            margin: 20px 0;
        }

        .logo {
            font-weight: bold;
            font-size: 24px;
            color: #000080;
        }

        .tagline {
            font-style: italic;
            margin-top: 5px;
            color: #008080;
        }

        /* Button styling */
        .win98-button {
            background-color: #c0c0c0;
            border-top: 2px solid #ffffff;
            border-left: 2px solid #ffffff;
            border-right: 2px solid #404040;
            border-bottom: 2px solid #404040;
            padding: 5px 10px;
            margin: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .win98-button:active {
            border-top: 2px solid #404040;
            border-left: 2px solid #404040;
            border-right: 2px solid #ffffff;
            border-bottom: 2px solid #ffffff;
        }
    </style>
</head>
<body>
    <!-- Desktop -->
    <div class="desktop" id="desktop">
        <!-- Desktop Icons -->
        <div class="icon" data-window="my-computer">
            <img src="/api/placeholder/32/32" alt="My Computer">
            <div class="icon-text">My Computer</div>
        </div>
        <div class="icon" data-window="ai-assistant">
            <img src="/api/placeholder/32/32" alt="Weiner AI">
            <div class="icon-text">Weiner AI</div>
        </div>
        <div class="icon" data-window="about">
            <img src="/api/placeholder/32/32" alt="About">
            <div class="icon-text">About WP</div>
        </div>
        <div class="icon" data-window="token">
            <img src="/api/placeholder/32/32" alt="Token Info">
            <div class="icon-text">$WEINER Token</div>
        </div>
        <div class="icon" data-window="team">
            <img src="/api/placeholder/32/32" alt="Team">
            <div class="icon-text">Our Team</div>
        </div>
        <div class="icon" data-window="roadmap">
            <img src="/api/placeholder/32/32" alt="Roadmap">
            <div class="icon-text">Roadmap</div>
        </div>
        <div class="icon" data-window="contact">
            <img src="/api/placeholder/32/32" alt="Contact">
            <div class="icon-text">Contact</div>
        </div>
    </div>

    <!-- Windows -->
    <div class="window" id="my-computer">
        <div class="window-header">
            <div>My Computer - Weiner Perkins</div>
            <div class="window-buttons">
                <div class="window-button minimize">_</div>
                <div class="window-button maximize">□</div>
                <div class="window-button close">X</div>
            </div>
        </div>
        <div class="window-content">
            <div class="logo-container">
                <div class="logo">WEINER PERKINS</div>
                <div class="tagline">Disrupting VC with Memecoins Since 2025</div>
            </div>
            <p>Welcome to Weiner Perkins, the premier fake venture capital firm specializing in ironic memecoins and web3 satire.</p>
            <p>Our $WEINER token is launching soon. Click the desktop icons to learn more about our revolutionary approach to fake VC.</p>
            <div style="text-align: center; margin-top: 20px;">
                <button class="win98-button">Buy $WEINER</button>
                <button class="win98-button">Join Community</button>
            </div>
        </div>
    </div>

    <div class="window" id="about">
        <div class="window-header">
            <div>About Weiner Perkins</div>
            <div class="window-buttons">
                <div class="window-button minimize">_</div>
                <div class="window-button maximize">□</div>
                <div class="window-button close">X</div>
            </div>
        </div>
        <div class="window-content about-content">
            <h3>About Weiner Perkins</h3>
            <p>Founded in 2025, Weiner Perkins is a satirical take on venture capital firms that perfectly captures the absurdity of the crypto memecoin space.</p>
            <p>Our mission is simple: create the most ridiculous yet oddly compelling memecoin the world has ever seen.</p>
            <h3>Our Investment Thesis</h3>
            <p>At Weiner Perkins, we invest exclusively in:</p>
            <ul>
                <li>Projects with no real utility</li>
                <li>Tokens with funny names</li>
                <li>Anything with a dog mascot</li>
                <li>Web3 ideas so bad they circle back to good</li>
            </ul>
            <p>We're proudly backing projects that traditional VCs like Kleiner Perkins would run from screaming.</p>
        </div>
    </div>

    <div class="window" id="token">
        <div class="window-header">
            <div>$WEINER Token Info</div>
            <div class="window-buttons">
                <div class="window-button minimize">_</div>
                <div class="window-button maximize">□</div>
                <div class="window-button close">X</div>
            </div>
        </div>
        <div class="window-content token-content">
            <h3>$WEINER Tokenomics</h3>
            <p>The $WEINER token is the cornerstone of our fake financial ecosystem:</p>
            <ul>
                <li>Total Supply: 69,420,000,000 $WEINER</li>
                <li>Initial Price: Whatever you're willing to pay</li>
                <li>Liquidity: As liquid as a hot dog at a summer BBQ</li>
                <li>Utility: None whatsoever</li>
            </ul>
            <h3>Token Distribution</h3>
            <ul>
                <li>69% - Public sale</li>
                <li>20% - Team (locked for 5 minutes)</li>
                <li>10% - Marketing (memes and more memes)</li>
                <li>1% - Actual development</li>
            </ul>
            <p>Remember: $WEINER is not a financial investment. It's a joke with a blockchain address.</p>
        </div>
    </div>

    <div class="window" id="team">
        <div class="window-header">
            <div>Weiner Perkins Team</div>
            <div class="window-buttons">
                <div class="window-button minimize">_</div>
                <div class="window-button maximize">□</div>
                <div class="window-button close">X</div>
            </div>
        </div>
        <div class="window-content team-content">
            <h3>Our Distinguished Team</h3>
            <p>Meet the brilliant minds behind Weiner Perkins:</p>
            <ul>
                <li><strong>Frank Weiner</strong> - Chief Meme Officer (CMO)</li>
                <li><strong>Hotdog Capital</strong> - Our AI-powered investor bot</li>
                <li><strong>Satoshi Nakasausage</strong> - Anonymous founder</li>
                <li><strong>Vitalik Butwiener</strong> - Smart contract developer</li>
            </ul>
            <p>Our team combines decades of experience in making jokes on the internet with absolutely no experience in venture capital.</p>
            <h3>Advisors</h3>
            <p>We're advised by a network of Twitter accounts with animal profile pictures and "not financial advice" in their bios.</p>
        </div>
    </div>

    <div class="window" id="roadmap">
        <div class="window-header">
            <div>Weiner Perkins Roadmap</div>
            <div class="window-buttons">
                <div class="window-button minimize">_</div>
                <div class="window-button maximize">□</div>
                <div class="window-button close">X</div>
            </div>
        </div>
        <div class="window-content roadmap-content">
            <h3>Strategic Roadmap</h3>
            <p><strong>Phase 1: Launch (Q2 2025)</strong></p>
            <ul>
                <li>Create this Windows 98 website</li>
                <li>Launch $WEINER token</li>
                <li>Get listed on CoinGecko (maybe)</li>
                <li>First meme competition</li>
            </ul>
            <p><strong>Phase 2: Growth (Q3 2025)</strong></p>
            <ul>
                <li>Reach 10,000 holders</li>
                <li>Launch Weiner Perkins Incubator for other joke tokens</li>
                <li>Announce partnerships with other memecoins</li>
                <li>Release "Why We Passed" blog about legitimate projects</li>
            </ul>
            <p><strong>Phase 3: Exit (Q4 2025)</strong></p>
            <ul>
                <li>Rug pull (just kidding!)</li>
                <li>Launch Weiner DAO to govern absolutely nothing</li>
                <li>Virtual office in some metaverse nobody uses</li>
                <li>Become a real VC firm through the power of irony</li>
            </ul>
        </div>
    </div>

    <div class="window" id="contact">
        <div class="window-header">
            <div>Contact Weiner Perkins</div>
            <div class="window-buttons">
                <div class="window-button minimize">_</div>
                <div class="window-button maximize">□</div>
                <div class="window-button close">X</div>
            </div>
        </div>
        <div class="window-content">
            <h3>Get in Touch</h3>
            <p>Have a ridiculous token idea? Want to join our fake portfolio?</p>
            <p>You can reach us at:</p>
            <ul>
                <li>Twitter: @WeinerPerkinsVC (not real yet)</li>
                <li>Discord: WeinerPerkins (coming soon)</li>
                <li>Telegram: t.me/WeinerPerkins (also coming soon)</li>
            </ul>
            <p>For serious inquiries only (just kidding, we don't take anything seriously)</p>
        </div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <div class="start-button" id="start-button">
            <img src="/api/placeholder/16/16" alt="Start">
            Start
        </div>
        <div class="taskbar-time" id="taskbar-time">4:20 PM</div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="start-menu">
        <div class="start-menu-header">Weiner Perkins</div>
        <div class="start-menu-items">
            <div class="start-menu-item" data-window="ai-assistant">
                <img src="/api/placeholder/24/24" alt="Weiner AI">
                Weiner AI
            </div>
            <div class="start-menu-item" data-window="my-computer">
                <img src="/api/placeholder/24/24" alt="My Computer">
                My Computer
            </div>
            <div class="start-menu-item" data-window="about">
                <img src="/api/placeholder/24/24" alt="About">
                About WP
            </div>
            <div class="start-menu-item" data-window="token">
                <img src="/api/placeholder/24/24" alt="Token Info">
                $WEINER Token
            </div>
            <div class="start-menu-item" data-window="team">
                <img src="/api/placeholder/24/24" alt="Team">
                Our Team
            </div>
            <div class="start-menu-item" data-window="roadmap">
                <img src="/api/placeholder/24/24" alt="Roadmap">
                Roadmap
            </div>
            <div class="start-menu-item" data-window="contact">
                <img src="/api/placeholder/24/24" alt="Contact">
                Contact
            </div>
        </div>
    </div>
    <!-- AI Assistant Window -->
    <div class="window active" id="ai-assistant" style="width: 1200px; height: 800px; top: 20px; left: 50px; z-index: 200;">
        <div class="window-header">
            <div>Weiner AI Assistant</div>
            <div class="window-buttons">
                <div class="window-button minimize">_</div>
                <div class="window-button maximize">□</div>
                <div class="window-button close">X</div>
            </div>
        </div>
        <div class="window-content" style="padding: 0; display: flex; height: calc(100% - 21px);">
            <!-- 3D Model Area -->
            <div class="model-container" style="width: 550px; background-color: #000080; border-right: 2px solid #404040; position: relative;">
                <div id="model-canvas-container" style="width: 100%; height: 100%; position: relative;">
                    <canvas id="model-canvas" style="width: 100%; height: 100%;"></canvas>
                    <div style="position: absolute; bottom: 15px; left: 0; width: 100%; text-align: center;">
                        <div style="color: white; font-size: 18px; font-weight: bold; margin-bottom: 10px;">WEINER AI</div>
                        <button class="win98-button" id="toggle-voice" style="font-size: 14px; padding: 8px 15px;">
                            <img src="/api/placeholder/16/16" alt="Sound" style="vertical-align: middle; margin-right: 8px;"> Voice: OFF
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Chat Interface -->
            <div class="chat-container" style="flex: 1; display: flex; flex-direction: column; height: 100%;">
                <!-- Chat Messages -->
                <div class="chat-messages" id="chat-messages" style="flex: 1; overflow-y: auto; padding: 20px; background-color: white; border: 1px inset #808080;">
                    <div class="message ai-message" style="margin-bottom: 15px;">
                        <div style="font-weight: bold; color: #000080; font-size: 16px; margin-bottom: 5px;">Weiner AI:</div>
                        <div style="background-color: #f0f0f0; padding: 15px; border: 1px solid #d0d0d0; border-radius: 5px; font-size: 16px; line-height: 1.4;">
                            Welcome to Weiner Perkins! I'm your AI investment advisor. How can I help you with your memecoin ventures today?
                        </div>
                    </div>
                </div>
                
                <!-- Chat Input -->
                <div class="chat-input" style="padding: 15px; background-color: #c0c0c0; border-top: 1px solid #808080;">
                    <div style="display: flex;">
                        <input type="text" id="user-input" 
                               style="flex: 1; padding: 8px; font-family: 'MS Sans Serif'; font-size: 14px; border: 1px inset #808080;" 
                               placeholder="Ask Weiner AI something...">
                        <button class="win98-button" id="send-button" style="margin-left: 8px; padding: 5px 15px; font-size: 14px;">Send</button>
                    </div>
                    <div style="display: flex; margin-top: 8px; font-size: 12px; color: #404040;">
                        <div>Powered by Anthropic Claude + Eleven Labs</div>
                        <div style="margin-left: auto;">Type /help for commands</div>
                    </div>
                    <div style="margin-top: 10px; text-align: center;">
                        <button id="test-api-button" class="win98-button" style="font-size: 12px;">Test API Connection</button>
                        <div id="api-test-result" style="font-size: 11px; margin-top: 5px; height: 20px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // Update clock
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            document.getElementById('taskbar-time').textContent = `${hours}:${minutes} ${ampm}`;
        }
        
        setInterval(updateClock, 1000);
        updateClock();

        // 3D Model Setup
        let modelScene, modelCamera, modelRenderer, modelControls, modelMixer, modelClock;
        let modelLoaded = false;
        
        function initModel() {
            if (modelLoaded) return;
            
            const container = document.getElementById('model-canvas-container');
            const canvas = document.getElementById('model-canvas');
            
            // Scene setup
            modelScene = new THREE.Scene();
            modelScene.background = new THREE.Color(0x000080); // Windows 98 blue
            
            // Camera setup
            const width = container.clientWidth;
            const height = container.clientHeight;
            modelCamera = new THREE.PerspectiveCamera(40, width / height, 0.1, 100);
            modelCamera.position.set(0, 0.5, 2.0); // Moved camera up and slightly closer
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            modelScene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(2, 2, 1);
            modelScene.add(directionalLight);
            
            // Renderer
            modelRenderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: true
            });
            modelRenderer.setSize(width, height);
            modelRenderer.setPixelRatio(window.devicePixelRatio);
            modelRenderer.outputEncoding = THREE.sRGBEncoding;
            
            // Controls - DISABLED
            modelControls = new THREE.OrbitControls(modelCamera, canvas);
            modelControls.target.set(0, 0.4, 0); // Look higher on the torso/chest
            modelControls.update();
            modelControls.enabled = false; // Disable all controls
            modelControls.enablePan = false;
            modelControls.enableZoom = false;
            modelControls.enableRotate = false;
            modelControls.enableDamping = false;
            
            // Animation clock
            modelClock = new THREE.Clock();
            
            // Load model
            const loader = new THREE.GLTFLoader();
            loader.load('https://raw.githubusercontent.com/webdevgf1/weiner/main/eric.glb', 
                function(gltf) {
                    const model = gltf.scene;
                    
                    // Scale and position the model
                    model.scale.set(1.0, 1.0, 1.0); // Return to normal scale
                    model.position.set(0, -2.4, 0); // Move much further down to show from hips up
                    
                    modelScene.add(model);
                    
                    // Set up animations if they exist
                    if (gltf.animations && gltf.animations.length) {
                        modelMixer = new THREE.AnimationMixer(model);
                        const action = modelMixer.clipAction(gltf.animations[0]);
                        action.play();
                    }
                    
                    // Center model in view
                    modelControls.target.set(0, 0.4, 0); // Target higher on the body
                    modelControls.update();
                    
                    modelLoaded = true;
                    animate();
                },
                function(xhr) {
                    console.log((xhr.loaded / xhr.total * 100) + '% loaded');
                },
                function(error) {
                    console.error('An error happened loading the model:', error);
                    // Fallback to placeholder image if model fails to load
                    document.getElementById('model-canvas-container').innerHTML = `
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                            <img src="/api/placeholder/480/480" alt="3D Model Placeholder" style="border: 3px inset #c0c0c0;">
                            <div style="margin-top: 15px; color: white; font-size: 18px; font-weight: bold;">WEINER AI</div>
                            <button class="win98-button" id="toggle-voice" style="margin-top: 20px; font-size: 14px; padding: 8px 15px;">
                                <img src="/api/placeholder/16/16" alt="Sound" style="vertical-align: middle; margin-right: 8px;"> Voice: OFF
                            </button>
                        </div>
                    `;
                    // Re-attach event listener to new button
                    document.getElementById('toggle-voice').addEventListener('click', function() {
                        voiceEnabled = !voiceEnabled;
                        this.innerHTML = `<img src="/api/placeholder/16/16" alt="Sound" style="vertical-align: middle; margin-right: 8px;"> Voice: ${voiceEnabled ? 'ON' : 'OFF'}`;
                    });
                }
            );
            
            // Handle window resize
            window.addEventListener('resize', onModelWindowResize);
        }

        // Add this to your index.html script section
function addTestVoiceButton() {
  const button = document.createElement('button');
  button.className = 'win98-button';
  button.textContent = 'Test Voice API';
  button.style.marginTop = '10px';
  button.onclick = async function() {
    console.log('Testing voice API...');
    try {
      const response = await fetch('/api/voice', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: 'This is a test of the voice API. If you can hear this, the voice is working correctly.' })
      });
      
      console.log('Voice test response status:', response.status);
      
      if (!response.ok) {
        const errorText = await response.text();
        console.error('Voice test error:', errorText);
        alert('Voice test failed: ' + errorText);
        return;
      }
      
      const audioBlob = await response.blob();
      console.log('Received audio blob:', audioBlob.type, audioBlob.size);
      
      const audioUrl = URL.createObjectURL(audioBlob);
      const audio = new Audio(audioUrl);
      audio.play();
      console.log('Audio playback started');
    } catch (error) {
      console.error('Voice test error:', error);
      alert('Voice test error: ' + error.message);
    }
  };
  
  // Add to the chat input area
  document.querySelector('.chat-input').appendChild(button);
}

// Call this function after page load
setTimeout(addTestVoiceButton, 1000);
        
        function onModelWindowResize() {
            if (!modelLoaded) return;
            
            const container = document.getElementById('model-canvas-container');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            modelCamera.aspect = width / height;
            modelCamera.updateProjectionMatrix();
            modelRenderer.setSize(width, height);
        }
        
        function animate() {
            if (!modelLoaded) return;
            
            requestAnimationFrame(animate);
            
            // Update controls
            modelControls.update();
            
            // Update animations
            if (modelMixer) {
                modelMixer.update(modelClock.getDelta());
            }
            
            // Auto-rotate the model slightly - DISABLED
            /* 
            if (modelScene && modelScene.children && modelScene.children.length > 0) {
                for (let i = 0; i < modelScene.children.length; i++) {
                    if (modelScene.children[i].type === "Group") {
                        modelScene.children[i].rotation.y += 0.005;
                    }
                }
            }
            */
            
            // Render scene
            modelRenderer.render(modelScene, modelCamera);
        }
        // AI Chat Functionality
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const toggleVoiceButton = document.getElementById('toggle-voice');
        
        let voiceEnabled = false;
        
        // Toggle voice function
        toggleVoiceButton.addEventListener('click', function() {
            voiceEnabled = !voiceEnabled;
            this.innerHTML = `<img src="/api/placeholder/16/16" alt="Sound" style="vertical-align: middle; margin-right: 5px;"> Voice: ${voiceEnabled ? 'ON' : 'OFF'}`;
        });
        
        // Function to add a message to the chat
        function addMessage(sender, message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'message user-message' : 'message ai-message';
            messageDiv.style.marginBottom = '15px';
            
            const senderDiv = document.createElement('div');
            senderDiv.textContent = sender;
            senderDiv.style.fontWeight = 'bold';
            senderDiv.style.color = isUser ? '#008000' : '#000080';
            senderDiv.style.fontSize = '16px';
            senderDiv.style.marginBottom = '5px';
            
            const contentDiv = document.createElement('div');
            contentDiv.textContent = message;
            contentDiv.style.backgroundColor = isUser ? '#e8f4e8' : '#f0f0f0';
            contentDiv.style.padding = '15px';
            contentDiv.style.border = `1px solid ${isUser ? '#c0d0c0' : '#d0d0d0'}`;
            contentDiv.style.borderRadius = '5px';
            contentDiv.style.fontSize = '16px';
            contentDiv.style.lineHeight = '1.4';
            
            if (isUser) {
                contentDiv.style.display = 'inline-block';
                contentDiv.style.textAlign = 'left';
                contentDiv.style.maxWidth = '80%';
            }
            
            messageDiv.appendChild(senderDiv);
            messageDiv.appendChild(contentDiv);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Function to show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message';
            typingDiv.id = 'typing-indicator';
            typingDiv.style.marginBottom = '15px';
            
            const senderDiv = document.createElement('div');
            senderDiv.style.fontWeight = 'bold';
            senderDiv.style.color = '#000080';
            senderDiv.style.fontSize = '16px';
            senderDiv.style.marginBottom = '5px';
            senderDiv.textContent = 'Weiner AI:';
            
            const indicatorDiv = document.createElement('div');
            indicatorDiv.className = 'typing-indicator';
            indicatorDiv.style.padding = '15px';
            indicatorDiv.innerHTML = '<span></span><span></span><span></span>';
            
            typingDiv.appendChild(senderDiv);
            typingDiv.appendChild(indicatorDiv);
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Function to remove typing indicator
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Function to handle AI response with Anthropic API
        async function getAIResponse(userMessage) {
            // Showing typing indicator
            showTypingIndicator();
            
            try {
                console.log("Attempting to call /api/chat endpoint...");
                
                // Call to your backend API that handles Anthropic API interaction
                const response = await fetch('/api/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    message: userMessage
    // No context parameter, let the backend use its own system prompt
  })
});
                
                console.log("API Response Status:", response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("API Error Response:", errorText);
                    throw new Error(`Failed to get response from AI: ${response.status} ${errorText}`);
                }
                
                const data = await response.json();
                console.log("API Response Data:", data);
                
                const aiResponseText = data.response || "No response was received from the AI service.";
                
                // Remove typing indicator
                removeTypingIndicator();
                
                // Play voice using Eleven Labs if enabled
                if (voiceEnabled) {
                    console.log("Voice enabled, attempting to play voice...");
                    playVoice(aiResponseText);
                }
                
                return aiResponseText;
            } catch (error) {
                console.error('Error getting AI response:', error);
                removeTypingIndicator();
                
                // Fallback response if API call fails
                return `Sorry, I'm having trouble connecting to my brain right now. As they say in VC, 'Sometimes the servers go down before the funding does.' Error details: ${error.message}`;
            }
        }

        async function playVoice(text) {
  try {
    console.log("Frontend: Calling voice API with text:", text.substring(0, 30) + "...");
    
    // This calls your voice.js endpoint
    const response = await fetch('/api/voice', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text })
    });
    
    if (!response.ok) {
      throw new Error(`Voice API error: ${response.status}`);
    }
    
    // Get audio data and play it
    const audioBlob = await response.blob();
    const audioUrl = URL.createObjectURL(audioBlob);
    const audio = new Audio(audioUrl);
    await audio.play();
  } catch (error) {
    console.error("Frontend: Error playing voice:", error);
  }
}
    
    // The response should be an audio blob
    const audioBlob = await response.blob();
    console.log("Received audio blob:", audioBlob.type, audioBlob.size);
    
    const audioUrl = URL.createObjectURL(audioBlob);
    
    // Create and play audio
    const audio = new Audio(audioUrl);
    audio.play().catch(e => console.error("Failed to play audio:", e));
  } catch (error) {
    console.error('Error playing voice:', error);
  }
}
        // Add test button functionality
        document.addEventListener('DOMContentLoaded', function() {
            // This might execute too early, so we also add it when the AI window is opened
            setupTestButton();
        });
        
        function setupTestButton() {
            const testButton = document.getElementById('test-api-button');
            const resultDiv = document.getElementById('api-test-result');
            
            if (testButton && resultDiv) {
                testButton.addEventListener('click', async function() {
                    resultDiv.textContent = "Testing API connection...";
                    resultDiv.style.color = "#000";
                    
                    try {
                        // Test the test endpoint
                        const testResponse = await fetch('/api/test');
                        let testOk = false;
                        let testData = null;
                        
                        if (testResponse.ok) {
                            testData = await testResponse.json();
                            testOk = true;
                            console.log("Test API response:", testData);
                        } else {
                            console.error("Test API failed:", testResponse.status);
                        }
                        
                        // Test the chat endpoint
                        const chatResponse = await fetch('/api/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                message: "This is a test message",
                                context: "Test context"
                            })
                        });
                        
                        let chatOk = false;
                        let chatData = null;
                        
                        if (chatResponse.ok) {
                            chatData = await chatResponse.json();
                            chatOk = true;
                            console.log("Chat API response:", chatData);
                        } else {
                            console.error("Chat API failed:", chatResponse.status);
                        }
                        
                        // Update result
                        if (testOk && chatOk) {
                            resultDiv.textContent = "✅ APIs are working correctly!";
                            resultDiv.style.color = "green";
                        } else {
                            resultDiv.textContent = `❌ API test: ${testOk ? 'OK' : 'Failed'}, Chat: ${chatOk ? 'OK' : 'Failed'}`;
                            resultDiv.style.color = "red";
                        }
                    } catch (error) {
                        console.error("API test error:", error);
                        resultDiv.textContent = `❌ Error: ${error.message}`;
                        resultDiv.style.color = "red";
                    }
                });
            }
        }
        
        // Open My Computer by default
        setTimeout(() => {
            // Don't open My Computer by default anymore, since we have the AI window
            // But make sure AI window is open
            document.getElementById('ai-assistant').classList.add('active');
            document.getElementById('ai-assistant').style.zIndex = "101";
            
            // Focus on the chat input
            document.getElementById('user-input').focus();
            
            // Initialize 3D model
            initModel();
        }, 500);
        
        // Add a test function to check API routes
        async function testApiRoutes() {
            try {
                const response = await fetch('/api/test');
                if (response.ok) {
                    const data = await response.json();
                    console.log("API test results:", data);
                    return data;
                } else {
                    console.error("API test failed:", response.status);
                    return null;
                }
            } catch (error) {
                console.error("API test error:", error);
                return null;
            }
        }
        
        // Test API routes when AI window is opened
        document.querySelectorAll('.icon[data-window="ai-assistant"], .start-menu-item[data-window="ai-assistant"]').forEach(item => {
            item.addEventListener('click', function() {
                // Initialize model if not already done
                setTimeout(() => {
                    initModel();
                    
                    // Test API routes
                    testApiRoutes().then(result => {
                        if (result) {
                            console.log("API routes are working. Environment variables:", result.env);
                        } else {
                            console.error("API routes test failed. Check Vercel logs.");
                            
                            // Add a message to the chat to indicate API issues
                            addMessage("System:", "Warning: Unable to connect to AI services. You might see canned responses until this is fixed. Please check browser console for details.", false);
                        }
                    });
                    
                    // Set up test button
                    setupTestButton();
                }, 100);
            });
        });
        // Start Menu Toggle
        document.getElementById('start-button').addEventListener('click', function() {
            document.getElementById('start-menu').classList.toggle('active');
        });

        // Hide Start Menu when clicking elsewhere
        document.addEventListener('click', function(event) {
            if (!event.target.closest('#start-button') && !event.target.closest('#start-menu')) {
                document.getElementById('start-menu').classList.remove('active');
            }
        });

        // Open windows from icons
        document.querySelectorAll('.icon, .start-menu-item').forEach(item => {
            item.addEventListener('click', function() {
                const windowId = this.getAttribute('data-window');
                document.querySelectorAll('.window').forEach(win => {
                    win.classList.remove('active');
                });
                
                const targetWindow = document.getElementById(windowId);
                targetWindow.classList.add('active');
                document.getElementById('start-menu').classList.remove('active');
                
                // Bring window to front (adjust z-index)
                document.querySelectorAll('.window.active').forEach(win => {
                    win.style.zIndex = "100";
                });
                targetWindow.style.zIndex = "101";
                
                // Special handling for AI Assistant window
                if (windowId === 'ai-assistant') {
                    targetWindow.style.width = "1200px";
                    targetWindow.style.height = "800px";
                    
                    // Focus on the chat input
                    setTimeout(() => {
                        document.getElementById('user-input').focus();
                    }, 100);
                }
            });
        });

        // Window Controls
        document.querySelectorAll('.window-button.close').forEach(button => {
            button.addEventListener('click', function() {
                this.closest('.window').classList.remove('active');
            });
        });

        document.querySelectorAll('.window-button.minimize').forEach(button => {
            button.addEventListener('click', function() {
                this.closest('.window').classList.remove('active');
            });
        });

        document.querySelectorAll('.window-button.maximize').forEach(button => {
            button.addEventListener('click', function() {
                const window = this.closest('.window');
                if (window.style.width === '100%') {
                    window.style.width = '500px';
                    window.style.height = '400px';
                    window.style.top = '50px';
                    window.style.left = '50px';
                } else {
                    window.style.width = '100%';
                    window.style.height = 'calc(100vh - 28px)';
                    window.style.top = '0';
                    window.style.left = '0';
                }
            });
        });

        // Make windows draggable
        document.querySelectorAll('.window').forEach(window => {
            makeWindowDraggable(window);
            
            // Initial positioning for windows
            if (window.id !== 'ai-assistant') {
                window.style.top = (Math.random() * 100 + 50) + "px";
                window.style.left = (Math.random() * 100 + 50) + "px";
                window.style.width = "500px";
                window.style.height = "400px";
            } else {
                // Special sizing for AI Assistant
                window.style.top = "20px";
                window.style.left = "50px";
                window.style.width = "1200px";
                window.style.height = "800px";
            }
        });
        
        function makeWindowDraggable(window) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            const header = window.querySelector('.window-header');
            
            if (header) {
                header.onmousedown = dragMouseDown;
            }
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // Get the mouse cursor position at startup
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // Call function whenever the cursor moves
                document.onmousemove = elementDrag;
                
                // Bring window to front
                document.querySelectorAll('.window').forEach(win => {
                    win.style.zIndex = "10";
                });
                window.style.zIndex = "101";
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // Calculate the new cursor position
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // Set the element's new position
                const top = (window.offsetTop - pos2);
                const left = (window.offsetLeft - pos1);
                
                // Prevent dragging outside viewport
                if (top >= 0 && top <= window.parentElement.clientHeight - 30) {
                    window.style.top = top + "px";
                }
                if (left >= 0 && left <= window.parentElement.clientWidth - 30) {
                    window.style.left = left + "px";
                }
            }
            
            function closeDragElement() {
                // Stop moving when mouse button is released
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }
        
        // Send message on button click
        sendButton.addEventListener('click', async function() {
            const message = userInput.value.trim();
            if (message) {
                // Add user message
                addMessage('You:', message, true);
                
                // Clear input
                userInput.value = '';
                
                // Get and display AI response
                const aiResponse = await getAIResponse(message);
                addMessage('Weiner AI:', aiResponse);
            }
        });
        
        // Send message on Enter key
        userInput.addEventListener('keypress', async function(e) {
            if (e.key === 'Enter') {
                const message = userInput.value.trim();
                if (message) {
                    // Add user message
                    addMessage('You:', message, true);
                    
                    // Clear input
                    userInput.value = '';
                    
                    // Get and display AI response
                    const aiResponse = await getAIResponse(message);
                    addMessage('Weiner AI:', aiResponse);
                }
            }
        });
        
        // Focus input when AI window is clicked
        document.getElementById('ai-assistant').addEventListener('click', function(e) {
            // Don't focus if clicking on a button
            if (!e.target.closest('button')) {
                userInput.focus();
            }
            
            // Bring window to front
            document.querySelectorAll('.window').forEach(win => {
                win.style.zIndex = "10";
            });
            this.style.zIndex = "101";
        });
    </script>
</body>
</html>
